<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাডমিন প্যানেল</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root { --primary-color: #2c3e50; --secondary-color: #16a085; --light-gray: #f0f2f5; --card-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; margin: 0; background-color: var(--light-gray); }
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 220px; background-color: #34495e; color: white; flex-shrink: 0; }
        .sidebar h3 { padding: 20px; text-align:center; border-bottom:1px solid #4a627a; margin: 0; }
        .sidebar a { display: flex; align-items: center; color: white; padding: 15px 20px; text-decoration: none; border-left: 4px solid transparent; cursor: pointer; }
        .sidebar a:hover, .sidebar a.active { background-color: #4a627a; border-left-color: var(--secondary-color); }
        .sidebar a i { margin-right: 15px; }
        .main-content { flex-grow: 1; padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .dashboard-card { background: white; padding: 20px; border-radius: 10px; box-shadow: var(--card-shadow); text-align: center; }
        .dashboard-card i { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 10px; }
        .dashboard-card h3 { margin: 0; font-size: 1.5rem; }
        .dashboard-card p { margin: 5px 0 0; color: #666; }
        .table-container { overflow-x: auto; background: white; padding: 15px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        td img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .proof-link { color: var(--primary-color); text-decoration: none; font-weight: bold; }
        .btn { padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; color: white; margin: 2px; }
        .btn-success { background-color: #27ae60; }
        .btn-danger { background-color: #e74c3c; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea, button { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button.btn-primary { background-color: var(--secondary-color); color: white; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h3>অ্যাডমিন প্যানেল</h3>
            <a class="nav-link active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i><span>ড্যাশবোর্ড</span></a>
            <a class="nav-link" data-page="pendingDonations"><i class="fas fa-hourglass-half"></i><span>Pending Donations</span></a>
            <a class="nav-link" data-page="donations"><i class="fas fa-hand-holding-heart"></i><span>ডোনেশন</span></a>
            <a class="nav-link" data-page="expenses"><i class="fas fa-file-invoice-dollar"></i><span>ব্যয়</span></a>
            <a class="nav-link" data-page="members"><i class="fas fa-users"></i><span>সদস্য</span></a>
            <a class="nav-link" data-page="notices"><i class="fas fa-bullhorn"></i><span>নোটিশ</span></a>
            <a class="nav-link" data-page="settings"><i class="fas fa-cog"></i><span>সেটিংস</span></a>
            <a id="adminLogoutBtn"><i class="fas fa-sign-out-alt"></i><span>লগআউট</span></a>
        </nav>
        <main class="main-content">
            <div id="dashboard" class="page active">
                <h2>ড্যাশবোর্ড</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card" id="total-users-card"><p>লোড হচ্ছে...</p></div>
                    <div class="dashboard-card" id="finance-summary-card"><p>লোড হচ্ছে...</p></div>
                    <div class="dashboard-card" id="blood-stats-card"><p>লোড হচ্ছে...</p></div>
                </div>
            </div>
            <div id="pendingDonations" class="page"><h2>অপেক্ষারত ডোনেশন</h2><div class="table-container"><table id="pending-donations-table"><thead><tr><th>ছবি</th><th>নাম</th><th>পরিমাণ</th><th>মাধ্যম</th><th>প্রমাণ</th><th>অ্যাকশন</th></tr></thead><tbody></tbody></table></div></div>
            <div id="donations" class="page"><h2>ডোনেশন পরিচালনা</h2><div class="table-container"><table id="donations-table"><thead><tr><th>ছবি</th><th>নাম</th><th>পরিমাণ</th><th>তারিখ</th><th>মাধ্যম</th><th>উদ্দেশ্য</th><th>অ্যাকশন</th></tr></thead><tbody></tbody></table></div></div>
            <div id="expenses" class="page"><h2>ব্যয় পরিচালনা</h2><div class="table-container"><table id="expenses-table"><thead><tr><th>খাত</th><th>পরিমাণ</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead><tbody></tbody></table></div></div>
            <div id="members" class="page"><h2>সদস্য পরিচালনা</h2><div class="table-container"><table id="members-table"><thead><tr><th>ছবি</th><th>নাম</th><th>মোবাইল</th><th>রক্তের গ্রুপ</th><th>অ্যাকশন</th></tr></thead><tbody></tbody></table></div></div>
            <div id="notices" class="page"><h2>নোটিশ পরিচালনা</h2><div id="notice-management"></div></div>
            <div id="settings" class="page"><h2>সেটিংস</h2><div id="settings-management"></div></div>
        </main>
    </div>
    
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, addDoc, deleteDoc, setDoc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyDerc9e0-e7WBnkK2GoinFejp7zszXJ3Jc", authDomain: "songho-8ef5c.firebaseapp.com", projectId: "songho-8ef5c", storageBucket: "songho-8ef5c.appspot.com", messagingSenderId: "489031747232", appId: "1:489031747232:web:4c1cde63dabaa620ed2bc5", measurementId: "G-5NY15E3XJJ" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    let isDataLoaded = {}; // To track loaded data for each page
    let allMembers = [], allDonations = [], allExpenses = [], allNotices = [];
    const donationPurposes = { "samajik": "সামাজিক উন্নয়ন", "khela": "খেলাধুলা", "mosjid": "মসজিদ উন্নয়ন" };

    document.addEventListener('DOMContentLoaded', () => {
        onAuthStateChanged(auth, user => {
            if (user) { showPage('dashboard'); } else { window.location.href = 'admin-login.html'; }
        });
        document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', (e) => showPage(e.currentTarget.dataset.page)));
        document.getElementById('adminLogoutBtn').addEventListener('click', () => signOut(auth));
    });

    async function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId)?.classList.add('active');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.querySelector(`.nav-link[data-page="${pageId}"]`)?.classList.add('active');
        
        if (isDataLoaded[pageId]) return;

        try {
            switch(pageId) {
                case 'dashboard':
                    const [memSnap, donSnap, expSnap] = await Promise.all([getDocs(collection(db, "members")), getDocs(collection(db, "donations")), getDocs(collection(db, "expenses"))]);
                    allMembers = memSnap.docs.map(d=>({id:d.id, ...d.data()}));
                    allDonations = donSnap.docs.map(d=>({id:d.id, ...d.data()}));
                    allExpenses = expSnap.docs.map(d=>({id:d.id, ...d.data()}));
                    renderDashboard();
                    break;
                case 'members':
                    if(!allMembers.length) allMembers = (await getDocs(collection(db, "members"))).docs.map(d=>({id:d.id, ...d.data()}));
                    renderMembers();
                    break;
                 // Add cases for other pages: expenses, notices, settings, etc.
                 // Each case will fetch its data if not already fetched, then call its render function.
            }
            isDataLoaded[pageId] = true;
        } catch(e) { console.error("Error loading page:", e); }
    }
    
    function renderDashboard() {
        document.getElementById('total-users-card').innerHTML = `<i class="fas fa-users"></i><h3>${allMembers.length}</h3><p>মোট সদস্য</p>`;
        const income = allDonations.reduce((s, d) => s + Number(d.amount), 0);
        const expense = allExpenses.reduce((s, e) => s + Number(e.amount), 0);
        document.getElementById('finance-summary-card').innerHTML = `<i class="fas fa-chart-line"></i><h3>${(income - expense).toLocaleString('bn-BD')}</h3><p>বর্তমান ব্যালেন্স</p>`;
        document.getElementById('blood-stats-card').innerHTML = `<i class="fas fa-tint"></i><h3>${allMembers.filter(m => m.blood).length}</h3><p>মোট রক্তদাতা</p>`;
    }

    function renderMembers() {
        const tbody = document.querySelector('#members-table tbody');
        tbody.innerHTML = allMembers.map(m => `<tr>
            <td><img src="${m.img || 'https://via.placeholder.com/40'}" alt="${m.name}"></td>
            <td>${m.name}</td><td>${m.phone}</td><td>${m.blood}</td>
            <td><button class="btn btn-danger" onclick="deleteData('members', '${m.id}')">Delete</button></td>
        </tr>`).join('');
    }
    
    window.deleteData = async (collectionName, docId) => {
        if (!confirm("Are you sure?")) return;
        await deleteDoc(doc(db, collectionName, docId));
        alert("Deleted successfully!");
        isDataLoaded = {}; // Reset cache
        showPage(document.querySelector('.nav-link.active').dataset.page); // Refresh current page
    };

    // Define other render functions and action handlers (approve/reject donation etc.)
</script>
</body>
</html>
