<!-- FILE: index.html -->
<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>হিজলী দিঘাপাড়া যুব সংঘ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { display: none; }
        :root { 
            --primary-color: #009688; --primary-dark: #00796b; --accent-color: #ffca28;
            --alert-color: #e74c3c; --light-gray: #f4f7f6; --dark-text: #2c3e50; 
            --light-text: #7f8c8d; --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.08); 
            --bkash-color: #d81b60; --nagad-color: #e65100;
        }
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; margin: 0; background-color: var(--light-gray); color: var(--dark-text); padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        header { background: linear-gradient(135deg, #009688, #004d40); color: white; padding: 30px 20px; text-align: center; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-bottom: -20px; padding-bottom: 60px; }
        header h1 { font-size: 1.8rem; margin: 0; font-weight: 700; } header p { margin: 5px 0 0; opacity: 0.95; }
        header .established { display: inline-block; background-color: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 12px; font-size: 0.85rem; }
        
        .page { display: none; padding: 15px; animation: fadeIn 0.4s ease-in-out; } .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background-color: white; padding: 20px; border-radius: 16px; box-shadow: var(--card-shadow); margin-bottom: 20px; border: 1px solid #fff; }
        h2 { font-size: 1.4rem; text-align: center; margin-bottom: 20px; color: var(--primary-dark); position: relative; padding-bottom: 10px; font-weight: 700; }
        h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 60px; height: 4px; background: linear-gradient(to right, var(--primary-color), var(--accent-color)); border-radius: 2px; }
        
        /* Notice */
        .notice-card { border-top: 5px solid var(--accent-color); padding: 0; margin-top: 25px; margin-bottom: 30px; }
        .notice-header { background: #fff; padding: 15px 20px; border-bottom: 1px solid #f0f0f0; } .notice-header h3 { margin: 0; color: var(--dark-text); }
        .notice-item { padding: 15px 20px; border-bottom: 1px solid #f0f0f0; } 
        .latest-notice { background-color: #fffde7; border-left: 4px solid var(--alert-color); animation: highlight-glow 3s infinite alternate; }
        @keyframes highlight-glow { 0% { background-color: #fff; } 50% { background-color: #fff8e1; } 100% { background-color: #fff; } }
        .new-badge { background-color: var(--alert-color); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; margin-left: 8px; font-weight: bold; }

        /* Inputs */
        .search-bar, input, select { width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; font-family: inherit; background: #fafafa; }
        button { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; border: none; cursor: pointer; font-size: 1rem; padding: 14px; border-radius: 12px; width: 100%; font-weight: 600; box-shadow: 0 4px 10px rgba(0, 150, 136, 0.3); }
        
        /* Features */
        .features-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 10px; }
        .feature-card-v2 { background: white; border-radius: 16px; overflow: hidden; box-shadow: var(--card-shadow); text-align: center; cursor: pointer; }
        .feature-card-v2-top { padding: 25px 10px; color: white; clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%); }
        .feature-card-v2-top i { font-size: 2rem; margin-bottom: 10px; }
        .feature-card-v2-bottom { padding: 10px; } .feature-card-v2-bottom p { margin: 0; font-size: 0.85rem; color: var(--light-text); }
        
        .card-member .feature-card-v2-top { background: linear-gradient(135deg, #00897b, #4db6ac); }
        .card-chada .feature-card-v2-top { background: linear-gradient(135deg, #fbc02d, #f57f17); }
        .card-fee .feature-card-v2-top { background: linear-gradient(135deg, #e53935, #ef5350); }
        .card-blood .feature-card-v2-top { background: linear-gradient(135deg, #8e24aa, #ab47bc); }
        .card-donate .feature-card-v2-top { background: linear-gradient(135deg, #1e88e5, #42a5f5); }

        /* Payment */
        .payment-grid { display: grid; gap: 15px; margin: 10px 0; }
        .payment-method-card { background: #fff; border-radius: 15px; padding: 20px; text-align: center; position: relative; overflow: hidden; }
        .bkash-card { background-color: #fff0f6; border: 1px solid #f8bbd0; color: var(--bkash-color); }
        .nagad-card { background-color: #fff8e1; border: 1px solid #ffecb3; color: var(--nagad-color); }
        .payment-number { font-weight: 800; font-size: 1.5rem; margin: 5px 0 0 0; letter-spacing: 1px; }

        /* Members & Donations */
        .member-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .member-item img { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; object-fit: cover; border: 2px solid var(--primary-color); }
        .donation-group { border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 12px; overflow: hidden; background: white; }
        .donation-header { display: flex; align-items: center; padding: 15px; cursor: pointer; }
        .donation-header img { width: 45px; height: 45px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
        .donation-details-list { display: none; background-color: #fafafa; border-top: 1px solid #eee; }
        .donation-group.active .donation-details-list { display: block; }

        /* Finance Table */
        .finance-cards-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .finance-card-mini { background: white; padding: 15px; border-radius: 12px; flex: 1; text-align: center; box-shadow: var(--card-shadow); border: 1px solid #eee; }
        .text-income { color: #27ae60; } .text-expense { color: #c0392b; } .text-balance { color: #2980b9; }
        .finance-table { width: 100%; border-collapse: collapse; min-width: 400px; }
        .finance-table th { background: linear-gradient(135deg, #009688, #00796b); color: white; padding: 12px 10px; text-align: right; }
        .finance-table td { padding: 12px 10px; border-bottom: 1px solid #f0f0f0; text-align: right; }
        .finance-table td:first-child, .finance-table th:first-child { text-align: left; padding-left: 15px; }
        .finance-footer-row td { background-color: #e8f5e9; font-weight: 800; border-top: 2px solid #009688; }

        /* Blood & Profile */
        .donor-card { padding: 15px; border-radius: 12px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative; border: 1px solid #eee; }
        .eligibility-badge { position: absolute; top: 15px; right: 15px; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; color: white; font-weight: bold; }
        .eligible { background: #4caf50; } .not-eligible { background: #f44336; }
        
        .profile-photo { width: 130px; height: 130px; border-radius: 50%; border: 4px solid var(--primary-color); object-fit: cover; display: block; margin: 0 auto; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fff; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; text-align: center; position: relative; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; box-shadow: 0 -4px 15px rgba(0,0,0,0.05); border-top-left-radius: 20px; border-top-right-radius: 20px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #bdc3c7; font-size: 0.75rem; cursor: pointer; }
        .nav-item i { font-size: 1.5rem; margin-bottom: 5px; } .nav-item.active { color: var(--primary-color); }
    </style>
</head>
<body>
    <header><h1>হিজলী দিঘাপাড়া যুব সংঘ</h1><p>বাগাতিপাড়া, নাটোর</p><div class="established">স্থাপিত: ২০২৬</div></header>
    <main>
        <!-- Home -->
        <div id="home-section" class="page">
            <div class="card notice-card">
                <div class="notice-header"><h3><i class="fas fa-bullhorn"></i> নোটিশ বোর্ড</h3></div>
                <div id="homeNoticeBoard" class="notice-list"><p style="padding:20px;text-align:center;">লোড হচ্ছে...</p></div>
            </div>
            <div class="features-grid">
                <div class="feature-card-v2 card-member" onclick="showPage('member-section')"><div class="feature-card-v2-top"><i class="fas fa-users"></i><h3>সদস্য তথ্য</h3></div><div class="feature-card-v2-bottom"><p>তালিকা দেখুন</p></div></div>
                <div class="feature-card-v2 card-chada" onclick="showPage('donation-section')"><div class="feature-card-v2-top"><i class="fas fa-hand-holding-heart"></i><h3>ডোনেশন</h3></div><div class="feature-card-v2-bottom"><p>সকল অনুদান</p></div></div>
                <div class="feature-card-v2 card-fee" onclick="showPage('finance-section')"><div class="feature-card-v2-top"><i class="fas fa-calculator"></i><h3>আয়-ব্যয়</h3></div><div class="feature-card-v2-bottom"><p>হিসাব দেখুন</p></div></div>
                <div class="feature-card-v2 card-blood" onclick="showPage('blood-section')"><div class="feature-card-v2-top"><i class="fas fa-droplet"></i><h3>ব্লাড ব্যাংক</h3></div><div class="feature-card-v2-bottom"><p>রক্তদাতা খুঁজুন</p></div></div>
                <div class="feature-card-v2 card-donate" onclick="showPage('donation-form-section')"><div class="feature-card-v2-top"><i class="fas fa-donate"></i><h3>অনুদান দিন</h3></div><div class="feature-card-v2-bottom"><p>সাহায্য পাঠান</p></div></div>
            </div>
        </div>

        <!-- Donation Form -->
        <div id="donation-form-section" class="page">
            <div class="card">
                <h2><i class="fas fa-hand-holding-usd"></i> অনুদান পাঠানোর মাধ্যম</h2>
                <p style="text-align:center;color:#555;margin-bottom:20px;">কার্যক্রম সচল রাখতে আপনার অনুদান কাম্য।</p>
                <div id="paymentNumbers" class="payment-grid"><p>লোড হচ্ছে...</p></div>
                <p style="border-top:1px solid #eee;padding-top:20px;margin-top:20px;text-align:center;color:#555;">টাকা পাঠানোর পর নিচের ফর্ম পূরণ করুন।</p>
                <form id="donationVerificationForm">
                    <input type="number" id="donationAmount" placeholder="টাকার পরিমাণ" required>
                    <select id="paymentMethod" required><option value="">পেমেন্ট মাধ্যম</option><option value="বিকাশ">বিকাশ</option><option value="নগদ">নগদ</option><option value="ক্যাশ">ক্যাশ</option></select>
                    <select id="donationPurpose" required><option value="">খাত (উদ্দেশ্য)</option><option value="সামাজিক উন্নয়ন">সামাজিক উন্নয়ন</option><option value="ঈদ অনুষ্ঠান">ঈদ অনুষ্ঠান</option><option value="খেলাধুলা">খেলাধুলা</option><option value="মসজিদ">মসজিদ</option><option value="মাদ্রাসা">মাদ্রাসা</option><option value="অসহায় সাহায্য">অসহায় সাহায্য</option><option value="সাধারণ তহবিল">সাধারণ তহবিল</option><option value="অন্যান্য">অন্যান্য</option></select>
                    <input type="text" id="transactionId" placeholder="নম্বর / TrxID" required>
                    <label>স্ক্রিনশট (ঐচ্ছিক):</label><input type="file" id="paymentProof" accept="image/*">
                    <button type="submit">জমা দিন</button>
                    <p id="donationFormStatus" style="text-align:center;margin-top:10px;"></p>
                </form>
            </div>
        </div>

        <!-- Members -->
        <div id="member-section" class="page"><h2><i class="fas fa-users"></i> সদস্য তালিকা</h2><div class="card"><input type="text" id="memberSearch" onkeyup="filterList('memberSearch','.member-item')" placeholder="খুঁজুন..."><div id="memberList"></div></div></div>

        <!-- Donations List -->
        <div id="donation-section" class="page"><h2><i class="fas fa-hand-holding-heart"></i> ডোনেশন তালিকা</h2><div class="card" style="background:transparent;box-shadow:none;padding:0;"><div id="donationListContainer"></div></div></div>

        <!-- Finance -->
        <div id="finance-section" class="page">
            <h2><i class="fas fa-file-invoice-dollar"></i> আয়-ব্যয় হিসাব</h2>
            <div class="finance-cards-container">
                <div class="finance-card-mini" style="border-bottom:3px solid #27ae60;"><h4>আয়</h4><p class="text-income" id="financeTotalIncome">0</p></div>
                <div class="finance-card-mini" style="border-bottom:3px solid #c0392b;"><h4>ব্যয়</h4><p class="text-expense" id="financeTotalExpense">0</p></div>
                <div class="finance-card-mini" style="border-bottom:3px solid #2980b9;"><h4>ব্যালেন্স</h4><p class="text-balance" id="financeTotalBalance">0</p></div>
            </div>
            <div class="card">
                <select id="financeMonthFilter" onchange="loadFinancePageData()"><option value="all">সর্বমোট হিসাব</option></select>
                <div style="overflow-x:auto;"><table class="finance-table"><thead><tr><th>খাত</th><th>আয়</th><th>ব্যয়</th><th>ব্যালেন্স</th></tr></thead><tbody id="financeTableBody"></tbody><tfoot><tr class="finance-footer-row"><td>মোট</td><td class="text-income" id="tableGrandTotalIncome">0</td><td class="text-expense" id="tableGrandTotalExpense">0</td><td class="text-balance" id="tableGrandTotalBalance">0</td></tr></tfoot></table></div>
            </div>
        </div>

        <!-- Blood -->
        <div id="blood-section" class="page"><h2><i class="fas fa-heartbeat"></i> রক্তদাতা</h2><div class="card" style="background:transparent;padding:0;box-shadow:none;"><div style="display:flex;gap:10px;margin-bottom:10px;"><select id="bloodGroupFilter" onchange="loadBloodDonors()"><option value="">গ্রুপ</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option></select><select id="bloodEligibilityFilter" onchange="loadBloodDonors()"><option value="all">সবাই</option><option value="eligible">রেডি</option></select></div><div id="bloodList"></div></div></div>

        <!-- Profile -->
        <div id="profile-section" class="page">
            <h2><i class="fas fa-user-circle"></i> প্রোফাইল</h2>
            <div class="card">
                <div style="position:relative;width:130px;margin:0 auto 20px;" onclick="document.getElementById('profilePhotoInput').click()">
                    <img id="profilePhoto" src="https://via.placeholder.com/150" class="profile-photo"><div style="position:absolute;bottom:5px;right:5px;background:#333;color:white;border-radius:50%;width:35px;height:35px;display:flex;align-items:center;justify-content:center;"><i class="fas fa-camera"></i></div>
                </div>
                <input type="file" id="profilePhotoInput" style="display:none;" accept="image/*">
                <p id="photoUploadStatus" style="text-align:center;font-size:0.8rem;"></p>
                <form id="profileEditForm">
                    <input type="text" id="profileName" placeholder="নাম" required>
                    <input type="tel" id="profilePhone" placeholder="মোবাইল" required>
                    <select id="profileBlood" required><option value="">রক্তের গ্রুপ</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option></select>
                    <label>জন্ম তারিখ:</label><input type="date" id="profileDob" required>
                    <input type="text" id="profileIncome" placeholder="পেশা">
                    <input type="text" id="profileLocation" placeholder="ঠিকানা">
                    <label>শেষ রক্তদান:</label><input type="date" id="lastDonationDate">
                    <select id="isWillingToDonate"><option value="true">রক্তদানে ইচ্ছুক: হ্যাঁ</option><option value="false">না</option></select>
                    <button type="submit">আপডেট</button>
                </form>
            </div>
            <div class="card"><button onclick="document.getElementById('myDonationsList').style.display = document.getElementById('myDonationsList').style.display === 'block' ? 'none' : 'block'" style="background:#f1f2f6;color:#444;">আমার ডোনেশন ইতিহাস <i class="fas fa-chevron-down"></i></button><div id="myDonationsList" style="display:none;padding-top:10px;"></div></div>
        </div>
    </main>

    <div id="memberModal" class="modal"><div class="modal-content"><span onclick="document.getElementById('memberModal').style.display='none'" style="position:absolute;top:15px;right:20px;font-size:28px;cursor:pointer;">&times;</span><img id="modalImg" src="" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:15px;"><h3 id="modalName"></h3><div id="modalDetails" style="text-align:left;"></div></div></div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home-section')"><i class="fas fa-home"></i><span>হোম</span></div>
        <div class="nav-item" onclick="showPage('member-section')"><i class="fas fa-users"></i><span>সদস্য</span></div>
        <div class="nav-item" onclick="showPage('donation-section')"><i class="fas fa-hand-holding-heart"></i><span>ডোনেশন</span></div>
        <div class="nav-item" onclick="showPage('finance-section')"><i class="fas fa-calculator"></i><span>হিসাব</span></div>
        <div class="nav-item" onclick="showPage('blood-section')"><i class="fas fa-heart"></i><span>রক্ত</span></div>
        <div class="nav-item" id="profileNavBtn" onclick="showPage('profile-section')"><i class="fas fa-user"></i><span>প্রোফাইল</span></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyDerc9e0-e7WBnkK2GoinFejp7zszXJ3Jc", authDomain: "songho-8ef5c.firebaseapp.com", projectId: "songho-8ef5c", storageBucket: "songho-8ef5c.appspot.com", messagingSenderId: "489031747232", appId: "1:489031747232:web:4c1cde63dabaa620ed2bc5", measurementId: "G-5NY15E3XJJ" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app);
        
        let currentUser=null, membersData=[], allDonations=[], allExpenses=[];

        onAuthStateChanged(auth, async(u)=>{
            if(u){
                currentUser=u; 
                if(!u.isAnonymous){
                    const d=await getDoc(doc(db,"members",u.uid));
                    if(!d.exists()) window.location.replace('complete-profile.html');
                    else loadProfile(d.data());
                } else document.getElementById('profileNavBtn').style.display='none';
                loadData(); document.body.style.display='block'; showPage('home-section');
            } else window.location.replace('login.html');
        });

        async function loadData(){
            const [m,d,e,n,s] = await Promise.all([
                getDocs(collection(db,"members")),
                getDocs(query(collection(db,"donations"), orderBy("date","desc"))),
                getDocs(query(collection(db,"expenses"), orderBy("date","desc"))),
                getDocs(query(collection(db,"notices"), orderBy("date","desc"))),
                getDoc(doc(db,"settings","payment"))
            ]);
            membersData=m.docs.map(x=>({id:x.id,...x.data()}));
            allDonations=d.docs.map(x=>({id:x.id,...x.data()}));
            allExpenses=e.docs.map(x=>({id:x.id,...x.data()}));
            
            renderNotices(n); renderPayment(s); renderMembers(); renderFinance(); renderBlood(); renderDonations();
        }

        function renderNotices(snap){
            const el = document.getElementById('homeNoticeBoard'); el.innerHTML='';
            if(snap.empty){ el.innerHTML='<p style="text-align:center;padding:20px;">নোটিশ নেই</p>'; return;}
            snap.docs.slice(0,5).forEach((d,i)=>{
                const n=d.data();
                el.innerHTML+=`<div class="notice-item ${i===0?'latest-notice':''}"><h4>${n.title} ${i===0?'<span class="new-badge">নতুন</span>':''}</h4><p style="font-size:0.8rem;color:#777;"><i class="far fa-calendar-alt"></i> ${new Date(n.date).toLocaleDateString('bn-BD')}</p></div>`;
            });
        }
        function renderPayment(snap){
            const div = document.getElementById('paymentNumbers');
            if(snap.exists()){
                const d=snap.data();
                div.innerHTML=`<div class="payment-method-card bkash-card"><h4>বিকাশ</h4><p class="payment-number">${d.bkash}</p></div><div class="payment-method-card nagad-card"><h4>নগদ</h4><p class="payment-number">${d.nagad}</p></div>`;
            }
        }
        function renderMembers(){
            const l=document.getElementById('memberList'); l.innerHTML='';
            membersData.forEach((m,i)=> l.innerHTML+=`<div class="member-item" onclick="viewMember('${m.id}')"><span style="font-weight:bold;color:var(--primary-color);margin-right:10px;">${(i+1).toLocaleString('bn-BD')}.</span><img src="${m.img||'https://via.placeholder.com/50'}"><div><b>${m.name}</b><br><small>${m.phone}</small></div></div>`);
        }
        window.viewMember=function(id){
            const m=membersData.find(x=>x.id===id);
            document.getElementById('modalImg').src=m.img||''; document.getElementById('modalName').innerText=m.name;
            document.getElementById('modalDetails').innerHTML=`<p><b>রক্ত:</b> ${m.blood}</p><p><b>পেশা:</b> ${m.income}</p><p><b>ঠিকানা:</b> ${m.location}</p><p><b>শেষ রক্তদান:</b> ${m.lastDonationDate||'নাই'}</p>`;
            document.getElementById('memberModal').style.display='block';
        }
        window.renderDonations=function(){
            const l=document.getElementById('donationListContainer'); l.innerHTML='';
            const uD={};
            allDonations.forEach(d=>{ if(!uD[d.userId])uD[d.userId]={name:d.userName,img:d.userImage,tot:0,hist:[]}; uD[d.userId].tot+=Number(d.amount); uD[d.userId].hist.push(d); });
            Object.values(uD).sort((a,b)=>b.tot-a.tot).forEach(u=>{
                let h=''; u.hist.forEach(x=>h+=`<div style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #eee;"><span>${x.purposeKey}</span><b>৳${x.amount}</b></div>`);
                l.innerHTML+=`<div class="donation-group"><div class="donation-header" onclick="this.parentElement.classList.toggle('active')"><img src="${u.img}"><div><b>${u.name}</b><br><small>মোট: ৳${u.tot}</small></div></div><div class="donation-details-list">${h}</div></div>`;
            });
        }
        window.renderFinance=function(){
            const filter=document.getElementById('financeMonthFilter').value; // Implement filtering logic if needed
            let inc=0, exp=0, cats={};
            const catsList=["সামাজিক উন্নয়ন","ঈদ অনুষ্ঠান","খেলাধুলা","মসজিদ","মাদ্রাসা","অসহায় সাহায্য","সাধারণ তহবিল","অন্যান্য"];
            catsList.forEach(c=>cats[c]={i:0,e:0});
            
            allDonations.forEach(d=>{ inc+=Number(d.amount); let k=d.purposeKey||'অন্যান্য'; if(!cats[k])cats[k]={i:0,e:0}; cats[k].i+=Number(d.amount); });
            allExpenses.forEach(e=>{ exp+=Number(e.amount); let k=e.purposeKey||'অন্যান্য'; if(!cats[k])cats[k]={i:0,e:0}; cats[k].e+=Number(e.amount); });
            
            document.getElementById('financeTotalIncome').innerText='৳'+inc; document.getElementById('financeTotalExpense').innerText='৳'+exp; document.getElementById('financeTotalBalance').innerText='৳'+(inc-exp);
            
            let html='';
            Object.keys(cats).forEach(k=>{ html+=`<tr><td>${k}</td><td>${cats[k].i}</td><td>${cats[k].e}</td><td>${cats[k].i-cats[k].e}</td></tr>`; });
            document.getElementById('financeTableBody').innerHTML=html;
            document.getElementById('tableGrandTotalIncome').innerText=inc; document.getElementById('tableGrandTotalExpense').innerText=exp; document.getElementById('tableGrandTotalBalance').innerText=inc-exp;
        }
        window.renderBlood=function(){
            const g=document.getElementById('bloodGroupFilter').value, e=document.getElementById('bloodEligibilityFilter').value;
            const l=document.getElementById('bloodList'); l.innerHTML='';
            membersData.filter(m=>m.blood && (g?m.blood===g:true)).forEach(m=>{
                 const d = new Date(m.lastDonationDate); const ready = !m.lastDonationDate || (new Date()-d)/(864e5)>120;
                 if(e==='eligible' && !ready) return;
                 l.innerHTML+=`<div class="donor-card"><span class="eligibility-badge ${ready?'eligible':'not-eligible'}">${ready?'রেডি':'অপেক্ষা'}</span><div style="display:flex;align-items:center;"><div style="background:#d32f2f;color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:10px;">${m.blood}</div><b>${m.name}</b></div><p><i class="fas fa-phone"></i> ${m.phone}</p></div>`;
            });
        }
        // Cloudinary & Form Submit logic same as previous
        document.getElementById('donationVerificationForm').addEventListener('submit', async(e)=>{
            e.preventDefault(); const btn=e.target.querySelector('button'); btn.disabled=true; btn.innerText='অপেক্ষা...';
            const f=document.getElementById('paymentProof').files[0]; let url=null;
            if(f){ const fd=new FormData(); fd.append('file',f); fd.append('upload_preset','songho_preset'); 
                const r=await fetch(`https://api.cloudinary.com/v1_1/dy7sxczfo/image/upload`,{method:'POST',body:fd}); const j=await r.json(); url=j.secure_url; }
            await addDoc(collection(db,"pending_donations"),{
                userId:currentUser.uid, userName:currentUser.displayName||'User', userImage:currentUser.photoURL||'',
                amount:document.getElementById('donationAmount').value, paymentMethod:document.getElementById('paymentMethod').value,
                purposeKey:document.getElementById('donationPurpose').value, transactionInfo:document.getElementById('transactionId').value,
                proofImageUrl:url, status:'pending', submittedAt:new Date(), date:new Date().toISOString().split('T')[0]
            });
            alert('জমা হয়েছে!'); e.target.reset(); btn.disabled=false; btn.innerText='জমা দিন';
        });
        
        window.showPage=(id)=>{ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); }
        window.filterList=(id,sel)=>{ const v=document.getElementById(id).value.toLowerCase(); document.querySelectorAll(sel).forEach(el=>el.style.display=el.innerText.toLowerCase().includes(v)?'flex':'none'); }
        function loadProfile(d){ 
            document.getElementById('profileName').value=d.name; document.getElementById('profilePhone').value=d.phone.replace('+880',''); 
            document.getElementById('profileBlood').value=d.blood; document.getElementById('profilePhoto').src=d.img;
        }
        document.getElementById('profilePhotoInput').addEventListener('change', async(e)=>{
             const f=e.target.files[0]; if(!f)return;
             const fd=new FormData(); fd.append('file',f); fd.append('upload_preset','songho_preset');
             const r=await fetch(`https://api.cloudinary.com/v1_1/dy7sxczfo/image/upload`,{method:'POST',body:fd}); const j=await r.json();
             await updateDoc(doc(db,"members",currentUser.uid),{img:j.secure_url}); document.getElementById('profilePhoto').src=j.secure_url;
        });
        document.getElementById('profileEditForm').addEventListener('submit',async(e)=>{
            e.preventDefault();
            await updateDoc(doc(db,"members",currentUser.uid),{
                name:document.getElementById('profileName').value, phone:'+880'+document.getElementById('profilePhone').value,
                blood:document.getElementById('profileBlood').value, dob:document.getElementById('profileDob').value,
                income:document.getElementById('profileIncome').value, location:document.getElementById('profileLocation').value,
                lastDonationDate:document.getElementById('lastDonationDate').value, isWillingToDonate:document.getElementById('isWillingToDonate').value
            }); alert('আপডেট হয়েছে!'); location.reload();
        });
    </script>
</body>
</html>
